#
# Useful standard ./configure options with respect to this Makefile:
# --prefix
# --exec_prefix
# --bindir
# --datadir

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datadir = @datadir@/tworld
#win32: datadir = .

CC = @CC@

CFLAGS =@cflags@ '-DROOTDIR="$(datadir)"'
LDFLAGS =@ldflags@
LOADLIBES =@loadlibes@

#
# End of configure section
#

OBJS = \
tworld.o series.o play.o solution.o res.o lxlogic.o mslogic.o help.o score.o \
random.o cmdline.o fileio.o err.o liboshw.a

#win32:OBJS += tworldres.o

tworld: $(OBJS)
	$(CC) $(LDFLAGS) -o $@ $^ $(LOADLIBES)

tworld.o   : tworld.c defs.h gen.h err.h series.h res.h play.h score.h \
             solution.h fileio.h help.h oshw.h cmdline.h ver.h
series.o   : series.c series.h defs.h gen.h err.h fileio.h solution.h
play.o     : play.c play.h defs.h gen.h err.h state.h random.h oshw.h res.h \
             mslogic.h lxlogic.h solution.h fileio.h
solution.o : solution.c solution.h defs.h gen.h err.h fileio.h
res.o      : res.c res.h defs.h gen.h fileio.h err.h oshw.h
lxlogic.o  : lxlogic.c lxlogic.h defs.h gen.h err.h state.h random.h
mslogic.o  : mslogic.c mslogic.h defs.h gen.h err.h state.h random.h
help.o     : help.c help.h defs.h gen.h state.h oshw.h ver.h
score.o    : score.c score.h defs.h gen.h err.h play.h
random.o   : random.c random.h defs.h gen.h
cmdline.o  : cmdline.c cmdline.h gen.h
fileio.o   : fileio.c fileio.h defs.h gen.h err.h
err.o      : err.c oshw.h err.h

#win32:tworldres.o: tworld.ico
#win32:	echo 1 ICON $^ | windres -o $@

liboshw.a: oshw.h defs.h gen.h state.h err.h oshw/*.c oshw/*.h
	(cd oshw && make)

mklynxcc: mklynxcc.c
	$(CC) -Wall -W -o $@ $^


all: tworld mklynxcc

clean:
	rm -f $(OBJS) tworld mklynxcc
	(cd oshw && make clean)

install: tworld
	cp -i ./tworld $(bindir)/.
	mkdir -p $(datadir)/data
	cp -i ./rc ./*.bmp $(datadir)/.
